# running_bitseq
http://bitseq.github.io/

#install
git clone https://github.com/BitSeq/BitSeq.git
cd Bitseq
make


#test command - pre-processing
BitSeq/parseAlignment Mopti-T3-YY_S189.sam -o Mopti-T3-YY_S189_no_tr.prob --trSeqFile Anopheles-coluzzii-Mali-NIH_TRANSCRIPTS_AcolM1.2.fa --trInfoFile --uniform --verbose


#sampling
BitSeq/estimateExpression Mopti-T3-YY_S189.prob -o Mopti-T3-YY_S189 --outType RPKM -p parameters1.txt -t Acol_genes.tr-NEW -P 2

#compute the mean and variance:
BitSeq/getVariance -o Mopti-T3-YY_S189.mean Mopti-T3-YY_S189.rpkm

#re-running with sample-specific tr files.
#high-throughput. I split up the for loop into 4 groups (Mopti Ccontrol, treatment, cyp1 control, treatment) to speed things up.
#Mopti
for file in Mopti-C*sam
do
BitSeq/parseAlignment $file -o $(basename $file .sam).prob --trSeqFile Anopheles-coluzzii-Mali-NIH_TRANSCRIPTS_AcolM1.2.fa --trInfoFile $(basename $file .sam).tr --uniform --verbose
BitSeq/estimateExpression $(basename $file .sam).prob -o $(basename $file .sam) --outType RPKM -p parameters1.txt -t $(basename $file .sam).tr -P 2
BitSeq/getVariance -o $(basename $file .sam).mean $(basename $file .sam).rpkm
done
for file in Mopti-T*sam
do
BitSeq/parseAlignment $file -o $(basename $file .sam).prob --trSeqFile Anopheles-coluzzii-Mali-NIH_TRANSCRIPTS_AcolM1.2.fa --trInfoFile $(basename $file .sam).tr --uniform --verbose
BitSeq/estimateExpression $(basename $file .sam).prob -o $(basename $file .sam) --outType RPKM -p parameters1.txt -t $(basename $file .sam).tr -P 2
BitSeq/getVariance -o $(basename $file .sam).mean $(basename $file .sam).rpkm
done

#cyp1
for file in cyp1-C*sam
do
BitSeq/parseAlignment $file -o $(basename $file .sam).prob --trSeqFile Anopheles-coluzzii-Mali-NIH_TRANSCRIPTS_AcolM1.2.fa --trInfoFile $(basename $file .sam).tr --uniform --verbose
BitSeq/estimateExpression $(basename $file .sam).prob -o $(basename $file .sam) --outType RPKM -p parameters1.txt -t $(basename $file .sam).tr -P 2
BitSeq/getVariance -o $(basename $file .sam).mean $(basename $file .sam).rpkm
done

for file in cyp1-T*sam
do
BitSeq/parseAlignment $file -o $(basename $file .sam).prob --trSeqFile Anopheles-coluzzii-Mali-NIH_TRANSCRIPTS_AcolM1.2.fa --trInfoFile $(basename $file .sam).tr --uniform --verbose
BitSeq/estimateExpression $(basename $file .sam).prob -o $(basename $file .sam) --outType RPKM -p parameters1.txt -t $(basename $file .sam).tr -P 2
BitSeq/getVariance -o $(basename $file .sam).mean $(basename $file .sam).rpkm
done

---
#differential expression

#compute overall mean and variance for each transcript
BitSeq/getVariance --log -o Mopti.Lmean Mopti*.rpkm 
BitSeq/getVariance --log -o cyp1.Lmean cyp1*.rpkm 

#estimate expression dependent hyperparameters
BitSeq/estimateHyperPar --meanFile Mopti.Lmean -o Mopti.param Mopti-C*rpkm C Mopti-T*rpkm
BitSeq/estimateHyperPar --meanFile cyp1.Lmean -o cyp1.param cyp1-C*rpkm C cyp1-T*rpkm

#estimate differential expression
BitSeq/estimateDE -o Mopti -p Mopti.param Mopti-C*rpkm C Mopti-T*rpkm
BitSeq/estimateDE -o cyp1 -p cyp1.param cyp1-C*rpkm C cyp1-T*rpkm

------------

#Mopti Treatment versus cyp1 treatment
#compute overall mean and variance for each transcript
BitSeq/getVariance --log -o all.Lmean *.rpkm 

#estimate expression dependent hyperparameters
BitSeq/estimateHyperPar --meanFile all.Lmean -o all.param Mopti-T*rpkm C cyp1-T*rpkm

#estimate differential expression
BitSeq/estimateDE -o all -p all.param Mopti-T*rpkm C cyp1-T*rpkm
